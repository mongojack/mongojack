<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from src/site/markdown/tutorial.md at 2020-01-20
 | Rendered using Apache Maven Fluido Skin 1.8
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>MongoDB Jackson Mapper &#x2013; Tutorial</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.8.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.8.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/mongojack/mongojack">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href="./" id="bannerLeft"><h2>MongoJack</h2>
</a></div>
          <div class="pull-right"><div id="bannerRight"><img src="images/mongodb-leaf.png"  alt=""/></div>
</div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2020-01-20<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 3.0.1-SNAPSHOT</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="http://maven.apache.org/" class="externalLink" title="Maven 3">Maven 3</a></li>
      <li class="pull-right"><a href="http://www.apache.org/" class="externalLink" title="Apache">Apache</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="installation.html" title="Installation"><span class="none"></span>Installation</a></li>
    <li class="active"><a href="#"><span class="none"></span>Tutorial</a></li>
    <li><a href="changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Tutorial</h1>
<p>Creating a JacksonMongoCollection is done by calling one of the JacksonMongoCollection.builder(), configuring the builder as desired, and calling one of the build() methods:</p>

<div>
<div>
<pre class="source">JacksonMongoCollection&lt;BlogPost&gt; coll = JacksonMongoCollection.builder().build(existingMongoClient, &quot;databaseName&quot;, &quot;collectionName&quot;, BlogPost.class);
</pre></div></div>

<p>or</p>

<div>
<div>
<pre class="source">MongoCollection&lt;BlogPost&gt; coll = JacksonMongoCollection.builder().build(existingMongoClient, &quot;databaseName&quot;, &quot;collectionName&quot;, BlogPost.class);
</pre></div></div>

<p>You can then use teh returned collection like any other MongoCollection instance, expecting it to accept and return mapped instances of your POJOs.</p>
<p>Inserting looks very similar to using the MongoDB Java driver:</p>

<div>
<div>
<pre class="source">BlogPost blogPost = ...
coll.insertOne(blogPost);
</pre></div></div>

<p>If the object id of the saved object was generated, you should be able to retrieve it from the object (assuming there&#x2019;s an accessor&#x2026;):</p>

<div>
<div>
<pre class="source">String id = blogPost.getId();
</pre></div></div>

<p>You can now load the object by that id:</p>

<div>
<div>
<pre class="source">BlogPost foundBlogPost = coll.find(Filters.eq(&quot;_id&quot;, id)).first();
</pre></div></div>

<p>Querying can be done using general mongo methods:</p>

<div>
<div>
<pre class="source">FindIterable&lt;BlogPost&gt; cursor = coll.find().filter(Filters.eq(&quot;published&quot;, true).in(&quot;tags&quot;, &quot;mongodb&quot;, &quot;java&quot;, &quot;jackson&quot;));
for (BlogPost blogPost : cursor) {
    // do something with your post
}
</pre></div></div>

<p>Most of the find methods take a query directly:</p>

<div>
<div>
<pre class="source">FindITerable&lt;BlogPost&gt; cursor = coll.find(Filters.or(
        Filters.eq(&quot;author&quot;, &quot;jsmith&quot;), 
        Filters.size(&quot;comments&quot;, 3));
</pre></div></div>

<p>More information about building queries can be found <a href="./queries.html">here</a>.</p>
<p>Since JacksonMongoCollection <i>implements</i> MongoCollection, all methods are present on the object, and they should all work as expected.  Returned iterables implement the underlying mongo interfaces, so they should also all work as expected.</p>
<p>When it comes to mapping your objects, generally all you need to use is the Jackson annotations, such as @JsonProperty and @JsonCreator.  If you want a type of ObjectId, you have two options, either make your field be of type ObjectId, or you can also use String, as long as you annotate <i>both</i> the serialising and deserialising properties with @org.mongojack.ObjectId.  For example:</p>

<div>
<div>
<pre class="source">public class BlogPost {
  private String id;
  @ObjectId
  @JsonProperty(&quot;_id&quot;)
  public String getId() {
    return id;
  }
  @ObjectId
  @JsonProperty(&quot;_id&quot;)
  public void setId(String id) {
    this.id = id;
  }
}
</pre></div></div>

<p>Now your id property will be stored in the database as an object ID, and you can let MongoDB generate it for you.  More information about ObjectIds can be found <a href="./object-ids.html">here</a>. You might not like annotating your ids with @JsonProperty(&quot;_id&quot;), MongoJack supports @javax.persistence.Id as a short hand for this:</p>

<div>
<div>
<pre class="source">public class BlogPost {
  @Id
  public Long id;
}
</pre></div></div>

<p>Another useful implication of this is if you want to use the same object for database objects and objects to return on the web, you can name the id whatever you want for the web, and you don&#x2019;t need to use Jackson views to to specify which property gets mapped to what name for the database and for the web.</p>
<p>The only limitation to using the id annotation is if you are using @Creator annotated constructors or factory methods, because @javax.persistence.Id is not supported on method parameters. For this reason, MongoJack provides the annotation @org.mongojack.Id, and it can be used like so:</p>

<div>
<div>
<pre class="source">public class BlogPost {
  private final String id;
  @JsonCreator
  public BlogPost(@Id @ObjectId id) {
    this.id = id;
  }
  @Id
  @ObjectId
  public String getId() {
    return id;
  }
}
</pre></div></div>

<p>As you can see, immutable objects are also supported because Jackson supports them, something that most other frameworks don&#x2019;t support.</p>
<p>You can use standard modify operations with your collection as well (<a class="externalLink" href="http://www.mongodb.org/display/DOCS/Updating#Updating-ModifierOperations">modifier operations</a>).  This should support mapping objects on saving as well:</p>

<div>
<div>
<pre class="source">coll.updateOne(Filters.eq(&quot;_id&quot;, &quot;someid&quot;), Updates.inc(&quot;numResponses&quot;).push(&quot;comments&quot;, new Comment(&quot;Great post!&quot;)));
</pre></div></div>

<p>If you&#x2019;re using references (which you probably shouldn&#x2019;t), MongoJack makes it easy to work with them.  You can declare a property to be of type org.mongojack.DBRef, which can be instantiated by supplying the ID and the collection name for the reference.  Alternatively, you can supply the class of that reference, if that class is annotated with @MongoCollection.  Having loaded the saved object with the reference, you can load the reference using DBReferenceManager:</p>

<div>
<div>
<pre class="source">@MongoCollection(name = &quot;comments&quot;)
public class Comment {
    @Id
    public String id;
    public String text;
}

public class BlogPost {
    @Id
    public String id;
    @ObjectId
    public List&lt;DBRef&lt;Comment, String&gt;&gt; comments;
}

BlogPost post = coll.findOneById(someId);

List&lt;Comment&gt; comments = dbReferenceManager.fetch(post.comments))
</pre></div></div>

<p>More information about DBRefs can be found <a href="./dbrefs.html">here</a>.</p>
<p>If you&#x2019;re using your data objects for both storage and web views, you might want to take advantage of Jacksons views feature, so that generated/transient properties aren&#x2019;t persisted, and properties that you don&#x2019;t want leaked and serialised to the web.  MongoJack supports this easily, by letting you pass in a view to the wrap method:</p>

<div>
<div>
<pre class="source">JacksonDBCollection&lt;BlogPost, String&gt; coll = JacksonMongoCollection.builder().view(DatabaseView.class).build(mongoClient, &quot;foo&quot;, &quot;bar&quot;, BlogPost.class);
</pre></div></div>

<p>Of course, if you really want to control things and Jackson&#x2019;s annotations aren&#x2019;t enough, the wrap method is also overloaded to accept an ObjectMapper.  When doing this, you must make sure to configure the object mapper to use the mongo custom jackson configuration:</p>

<div>
<div>
<pre class="source">ObjectMapper myObjectMapper = ...
MongoJackModule.configure(myObjectMapper);
JacksonMongoCollection&lt;BlogPost&gt; coll = JacksonMongoCollection.builder()
    .objectMapper(myObjectMapper)
    .build(existingMongoClient, &quot;databaseName&quot;, &quot;collectionName&quot;, BlogPost.class);
</pre></div></div>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &#169;      2011&#x2013;2020<a href="http://www.devbliss.com">devbliss GmbH</a>.
.</p>
        </div>
      </div>
    </footer>
  </body>
</html>